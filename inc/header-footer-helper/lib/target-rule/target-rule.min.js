!function(e,t,r){var a=function(t){e(t).select2({placeholder:astRules.search,ajax:{url:ajaxurl,dataType:"json",method:"post",delay:250,data:function(t){var r=e(".tmpcoder-layout-tabs .nav-tab-active").attr("data-title");return{q:t.term,page:t.page,action:"tmpcoder_get_posts_by_query",nonce:astRules.ajax_nonce,layout_type:r}},processResults:function(e){return{results:e}},cache:!0},minimumInputLength:2,language:astRules.ast_lang})},n=function(t){var r=t.find(".tmpcoder-target_rule-input");r.val();var a=[];t.find(".tmpcoder-target-rule-condition").each(function(t){var r=e(this),n={},o=r.find("select.target_rule-condition"),c=r.find("select.target_rule-specific-page"),i=o.val(),d=c.val();""!=i&&(n={type:i,specific:d},a.push(n))});var n=JSON.stringify(a);r.val(n)},o=function(e){type=e.closest(".tmpcoder-target-rule-wrapper").attr("data-type"),rules=e.find(".tmpcoder-target-rule-condition"),show_close=!1,"display"==type?rules.length>1&&(show_close=!0):show_close=!0,rules.each(function(){show_close?jQuery(this).find(".target_rule-condition-delete").removeClass("tmpcoder-hidden"):jQuery(this).find(".target_rule-condition-delete").addClass("tmpcoder-hidden")})},c=function(t,r){var a=e(".tmpcoder-target-rule-display-on-wrap"),n=e(".tmpcoder-target-rule-exclude-on-wrap"),o=n.closest("tr"),c=a.find(".target_rule-add-exclusion-rule"),i=n.find(".tmpcoder-target-rule-condition");!0==r?(o.addClass("tmpcoder-hidden"),c.removeClass("tmpcoder-hidden")):!0==t?(o.removeClass("tmpcoder-hidden"),c.addClass("tmpcoder-hidden")):1==i.length&&""==e(i[0]).find("select.target_rule-condition").val()?(o.addClass("tmpcoder-hidden"),c.removeClass("tmpcoder-hidden")):(o.removeClass("tmpcoder-hidden"),c.addClass("tmpcoder-hidden"))};e(document).ready(function(e){t.targetField=function(){jQuery(".tmpcoder-target-rule-condition").each(function(){var t=e(this),r=t.find("select.target_rule-condition").val(),a=t.next(".target_rule-specific-page-wrap");"specifics"==r&&a.slideDown(300)}),jQuery("select.target-rule-select2").each(function(e,t){a(t)}),jQuery(".tmpcoder-target-rule-selector-wrapper").each(function(){o(jQuery(this))}),c(),jQuery(document).on("change",".tmpcoder-target-rule-condition select.target_rule-condition",function(t){var r=jQuery(this),a=r.val(),o=r.closest(".tmpcoder-target-rule-wrapper");"specifics"==a?("type_single_product"==e(".tmpcoder-layout-tabs .nav-tab-active").attr("data-title")&&r.closest(".tmpcoder-target-rule-condition").next(".target_rule-specific-page-wrap").find(".select2-search__field").attr("placeholder","Search product"),r.closest(".tmpcoder-target-rule-condition").next(".target_rule-specific-page-wrap").slideDown(300)):r.closest(".tmpcoder-target-rule-condition").next(".target_rule-specific-page-wrap").slideUp(300),n(o)}),jQuery(".tmpcoder-target-rule-selector-wrapper").on("change",".target-rule-select2",function(e){n(jQuery(this).closest(".tmpcoder-target-rule-wrapper"))})},t.cloneCondition=function(){jQuery(".tmpcoder-target-rule-selector-wrapper").on("click",".target_rule-add-rule-wrap a",function(e){e.preventDefault(),e.stopPropagation();var t=jQuery(this),r=parseInt(t.attr("data-rule-id"))+1,n=t.attr("data-rule-type"),c=t.closest(".tmpcoder-target-rule-selector-wrapper").find(".target_rule-builder-wrap"),i=jQuery("#tmpl-tmpcoder-target-rule-"+n+"-condition").length>0?wp.template("tmpcoder-target-rule-"+n+"-condition"):null,d=t.closest(".tmpcoder-target-rule-wrapper");i&&c.append(i({id:r,type:n})),a(".tmpcoder-target-rule-"+n+"-on .target-rule-select2"),t.attr("data-rule-id",r),o(d)})},t.deleteFunction=function(){jQuery(".tmpcoder-target-rule-selector-wrapper").on("click",".target_rule-condition-delete",function(e){var t=jQuery(this),r=t.closest(".tmpcoder-target-rule-condition"),a=t.closest(".tmpcoder-target-rule-wrapper");cnt=0,data_type=a.attr("data-type"),optionVal=t.siblings(".target_rule-condition-wrap").children(".target_rule-condition").val(),"exclude"==data_type&&1===a.find(".target_rule-condition").length?(a.find(".target_rule-condition").val(""),a.find(".target_rule-specific-page").val(""),a.find(".target_rule-condition").trigger("change"),c(!1,!0)):(t.parent(".tmpcoder-target-rule-condition").next(".target_rule-specific-page-wrap").remove(),r.remove()),a.find(".tmpcoder-target-rule-condition").each(function(e){var t=jQuery(this),r=t.attr("data-rule"),a=t.find(".target_rule-condition"),n=(t.find(".target_rule-specific-page"),a.attr("name"));t.attr("data-rule",e),a.attr("name",n.replace("["+r+"]","["+e+"]")),t.removeClass("tmpcoder-target-rule-"+r).addClass("tmpcoder-target-rule-"+e),cnt=e}),a.find(".target_rule-add-rule-wrap a").attr("data-rule-id",cnt),o(a),n(a)})},t.targetField(),t.cloneCondition(),t.deleteFunction(),jQuery(".tmpcoder-target-rule-selector-wrapper").on("click",".target_rule-add-exclusion-rule a",function(e){e.preventDefault(),e.stopPropagation(),c(!0)})})}(jQuery,window);