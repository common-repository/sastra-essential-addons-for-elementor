jQuery(document).ready(function(e){"use strict";var t=".target_rule-condition",o=".tmpcoder-condition-input-ids",n=e(".tmpcoder-condition-popup-wrap"),i=e(".tmpcoder-nav-tab-wrapper .nav-tab-active").attr("data-title");function c(){var t=i.replace(" ","_");return e(".template-filters").length>0&&(t=(t=e(".template-filters .active-filter").last().attr("data-class")).substring(0,t.length-1)),t}function a(){var t="my_templates"===c()?"elementor_library":TmpcoderPluginOptions.post_type,o=e(".tmpcoder-user-template-title").val(),a="user-"+c()+"-"+o.replace(/\W+/g,"-").toLowerCase();"elementor_library"===t&&(a=c()+"-"+o.replace(/\W+/g,"-").toLowerCase()),s("create_btn");var p={action:"tmpcoder_create_template",nonce:TmpcoderPluginOptions.nonce,user_template_library:t,user_template_title:o,user_template_slug:a,user_template_type:c()};e.post(ajaxurl,p,function(t){r("create_btn");var o=t.substring(0,t.length-1);if(!o)return e(".tmpcoder-create-template").before('<p class="tmpcoder-fill-out-the-title"><em>'+TmpcoderPluginOptions.valid_name_msg+"</em></p>"),e(".tmpcoder-fill-out-the-title").css("margin-top","4px"),e(".tmpcoder-fill-out-the-title em").css({color:"#ff3333","font-size":"smaller"}),e(".tmpcoder-fill-out-the-title").fadeOut(3e3),!1;e(".tmpcoder-user-template-popup-wrap").fadeOut(),setTimeout(function(){if("my_templates"===i.replace(/\W+/g,"-").toLowerCase()){var t,s,r,p,m,h=TmpcoderPluginOptions.admin_url+"post.php?post="+o+"&action=elementor";h=TmpcodersanitizeURL(h),window.location.href=h;return}e(".tmpcoder-save-conditions").attr("data-slug",a).attr("data-id",o),c(),s=e(".tmpcoder-user-template-title").val(),r=a,p=o,m="",m+="<li>",m+='<h3 class="tmpcoder-title">'+s+"</h3>",m+='<div class="tmpcoder-action-buttons">',m+='<span class="tmpcoder-template-conditions button-primary" data-slug="'+r+'">Manage Conditions</span>',m+='<a href="post.php?post='+p+'&action=elementor" class="tmpcoder-edit-template button-primary">Edit Template</a>',m+='<span class="tmpcoder-delete-template button-primary" data-slug="'+r+'" data-warning="Are you sure you want to delete this template?"><span class="dashicons dashicons-trash"></span></span>',m+="</div>",m+="</li>",e(".tmpcoder-my-templates-list.tmpcoder-"+c()+"-templates-list").prepend(m),e(".tmpcoder-empty-templates-message").length&&e(".tmpcoder-empty-templates-message").remove(),l(),d(),e(".tmpcoder-no-templates").length&&e(".tmpcoder-no-templates").hide(),u(o),n.addClass("editor-redirect")},500)})}function s(t){if("create_btn"==t){var o=e(".tmpcoder-create-template").text();e(".tmpcoder-create-template").text(o+" . . ."),e(".tmpcoder-create-template").css("opacity","0.5"),e(".tmpcoder-create-template").css("pointer-events","none")}if("save_btb"==t){var n=e(".tmpcoder-save-conditions").text();e(".tmpcoder-save-conditions").text(n+" . . ."),e(".tmpcoder-save-conditions").css("opacity","0.5"),e(".tmpcoder-save-conditions").css("pointer-events","none")}}function r(t){"create_btn"==t&&(e(".tmpcoder-create-template").text("Create Template"),e(".tmpcoder-create-template").css("opacity","1"),e(".tmpcoder-create-template").removeAttr("style")),"save_btb"==t&&(e(".tmpcoder-save-conditions").text("SAVE CONDITIONS"),e(".tmpcoder-save-conditions").css("opacity","1"),e(".tmpcoder-save-conditions").removeAttr("style"))}function d(){e(".tmpcoder-delete-template").on("click",function(){var t=e(this);if(confirm(t.data("warning"))){var o="my_templates"===c()?"elementor_library":TmpcoderPluginOptions.post_type,n=t.attr("data-slug"),a=t.attr("data-nonce");t.closest("li").css("opacity","0.5"),t.closest("li").css("pointer-events","none");var s={nonce:a,action:"tmpcoder_delete_template",template_slug:n,template_library:o};if(e.post(ajaxurl,s,function(e){t.closest("li").remove()}),e.post(ajaxurl,s,function(t){setTimeout(function(){0===e(".tmpcoder-my-templates-list li").length&&e(".tmpcoder-my-templates-list").append('<li class="tmpcoder-no-templates">You don\'t have any templates yet!</li>')},500)}),"my_templates"!==c()){var r=JSON.parse(e("#tmpcoder_"+i+"_conditions").val());delete r[n],e("#tmpcoder_"+i+"_conditions").val(JSON.stringify(r));var s={action:"tmpcoder_save_template_conditions",nonce:TmpcoderPluginOptions.nonce};s["tmpcoder_"+i+"_conditions"]=JSON.stringify(r)}}})}function l(){e(".tmpcoder-template-conditions").on("click",function(){var t=e(this).attr("data-slug"),o=e(this).attr("data-conditions");e(".tmpcoder-save-conditions").attr("data-slug",t);var n=e(this);u(t,o,n)})}function p(){e(".tmpcoder-conditions-wrap").append('<div class="tmpcoder-conditions">'+e(".tmpcoder-conditions-sample").html()+"</div>"),e(".tmpcoder-target-rule-condition").removeClass("tmpcoder-tab-"+i).addClass("tmpcoder-tab-"+i);var t=e(".tmpcoder-target-rule-condition").last();t.find("select").not(":first-child").hide(),t.hide().fadeIn();var o=e(".template-filters .active-filter").attr("data-class");t.hasClass("tmpcoder-tab-product_single")&&setTimeout(function(){t.find(".tmpcoder-condition-input-ids").each(function(){e(this).val()||e(this).val("all").show()})},600),"blog-posts"===o||"custom-posts"===o?(t.find(".singles-condition-select").children(":nth-child(1),:nth-child(2),:nth-child(3)").remove(),t.find(".tmpcoder-condition-input-ids").val("all").show()):"woocommerce-products"===o?(t.find(".singles-condition-select").children().filter(function(){return"product"!==e(this).val()}).remove(),t.find(".tmpcoder-condition-input-ids").val("all").show()):"404-pages"===o?t.find(".singles-condition-select").children().filter(function(){return"page_404"!==e(this).val()}).remove():"blog-archives"===o||"custom-archives"===o?t.find(".archives-condition-select").children().filter(function(){return"products"==e(this).val()||"product_cat"==e(this).val()||"product_tag"==e(this).val()}).remove():"woocommerce-archives"===o&&t.find(".archives-condition-select").children().filter(function(){return"products"!==e(this).val()&&"product_cat"!==e(this).val()&&"product_tag"!==e(this).val()}).remove()}function m(n){var c=e("#tmpcoder_"+i+"_conditions").val();if(void 0!=c&&(c=""!==c?JSON.parse(c):{}),e(".tmpcoder-conditions").remove(),void 0!=c[n]&&c[n].length>0){for(var a=0;a<c[n].length;a++)p(),e(".tmpcoder-conditions").find("select").hide();e(".tmpcoder-conditions").length&&e(".tmpcoder-conditions").each(function(i){for(var a=c[n][i].split("/"),s=0;s<a.length;s++)0===s?(e(this).find(t).val(a[s]).trigger("change"),e(this).find("."+a[s]+"s-condition-select").show()):1===s?(a[s-1]="product_archive"===a[s-1]?"archive":a[s-1],e(this).find("."+a[s-1]+"s-condition-select").val(a[s]).trigger("change")):2===s&&e(this).find(o).val(a[s]).trigger("keyup").show()})}"true"===e(".tmpcoder-template-conditions[data-slug="+n+"]").attr("data-show-on-canvas")?e(".tmpcoder-canvas-condition").find("input[type=checkbox]").attr("checked","checked"):e(".tmpcoder-canvas-condition").find("input[type=checkbox]").removeAttr("checked")}function u(t,o,i){if(i)var c=i.attr("data-id");else var c=t;e(".tmpcoder-save-conditions").attr("data-id",c);var a=e(".tmpcoder-layout-tabs .nav-tab-active").attr("data-title"),s={action:"tmpcoder_select_popup_conditions",nonce:TmpcoderPluginOptions.nonce,template_id:c,layout_type:a};jQuery.ajax({url:ajaxurl,method:"POST",data:s,beforeSend:function(){e(".tmpcoder-options-row-content").html(e(".popup-loader-html").html()),e(".tmpcoder-options-row-content .welcome-backend-loader").fadeIn(),e(".tmpcoder-options-row-content .welcome-backend-loader img").css("position","absolute"),e(".tmpcoder-options-row-content").css("height","100px"),e(".tmpcoder-save-conditions").css("pointer-events","none")}}).done(function(t){e(".tmpcoder-options-row-content").html(t),e(".target_rule-add-exclusion-rule").addClass("tmpcoder-hidden"),window.cloneCondition(),window.deleteFunction(),window.targetField(),e(".tmpcoder-save-conditions").removeAttr("style")}).fail(function(e){console.log(e)}),n.fadeIn()}function h(){e(".tmpcoder-canvas-condition input[type=checkbox]").on("change",function(){e(".tmpcoder-template-conditions[data-slug="+e(".tmpcoder-save-conditions").attr("data-slug")+"]").attr("data-show-on-canvas",e(this).prop("checked"))})}if(i&&(i=(i=i.trim().toLowerCase()).replace(" ","_")),e(".tmpcoder-user-template").on("click",function(){if(e(this).find("div").length){alert("Please Install/Activate WooCommerce!");return}e(".tmpcoder-user-template-title").val(""),e(".tmpcoder-user-template-popup-wrap").fadeIn()}),e(".tmpcoder-user-template-popup").find(".close-popup").on("click",function(){e(".tmpcoder-user-template-popup-wrap").fadeOut()}),e(".tmpcoder-create-template").on("click",function(){""===e(".tmpcoder-user-template-title").val()?(e(".tmpcoder-user-template-title").css("border-color","red"),e(".tmpcoder-fill-out-the-title").length<1&&(e(".tmpcoder-create-template").before('<p class="tmpcoder-fill-out-the-title"><em>Please fill the Title field.</em></p>'),e(".tmpcoder-fill-out-the-title").css("margin-top","4px"),e(".tmpcoder-fill-out-the-title em").css({color:"#ff3333","font-size":"smaller"}))):(e(".tmpcoder-user-template-title").removeAttr("style"),e(".tmpcoder-create-template + p").remove(),a())}),e(".tmpcoder-user-template-title").keypress(function(e){13==e.which&&(e.preventDefault(),a())}),d(),l(),n.find(".close-popup").on("click",function(){n.fadeOut()}),e(".tmpcoder-add-conditions").on("click",function(){p(),e(".tmpcoder-conditions").last().find("input").hide(),("type_header"===i||"type_footer"===i)&&e(".tmpcoder-canvas-condition").show(),e(".tmpcoder-delete-template-conditions").on("click",function(){var n,a,s,r,d,l,p=e(this).parent(),m=e("#tmpcoder_"+i+"_conditions").val();m=""!==m?JSON.parse(m):{},e("#tmpcoder_"+i+"_conditions").val(JSON.stringify(function t(o,n){var i=[];for(var a in e(".tmpcoder-template-conditions").each(function(){i.push(e(this).attr("data-slug"))}),o)if(o.hasOwnProperty(a)){for(var s=0;s<o[a].length;s++)n==o[a][s]&&"popup"!==c()&&o[a].splice(s,1);-1===i.indexOf(a)&&delete o[a]}return o}(m,(n=p,a="",s="none"!==n.find(t).css("display")?n.find(t).val():i,r=n.find(".archives-condition-select").val(),d=n.find(".singles-condition-select").val(),l=n.find(o),"archive"===s||"product_archive"===s?"none"!==l.css("display")?s+"/"+r+"/"+l.val():s+"/"+r:"single"===s||"product_single"===s?"none"!==l.css("display")?s+"/"+d+"/"+l.val():s+"/"+d:"global")))),p.fadeOut(500,function(){e(this).remove(),0===e(".tmpcoder-conditions").length&&e(".tmpcoder-canvas-condition").hide()})}),e(t).on("change",function(){e(this).parent().find("."+e(this).val()+"s-condition-select").show()}),e(".archives-condition-select, .singles-condition-select, .target_rule-condition").on("change",function(){var t=e(this).parent(),n=e("option:selected",this),i=e(this).val();n.hasClass("custom-ids")||n.hasClass("custom-type-ids")?t.find(o).val("all").trigger("keyup").show():t.find(o).hide(),console.log(i),0===i.indexOf("pro-")?e(".tmpcoder-expert-notice").show():e(".tmpcoder-expert-notice").hide()})}),e(".tmpcoder-save-conditions").on("click",function(){var t,o,c,a=1===e(".tmpcoder-my-templates-list").data("pro"),d=e(this).attr("data-slug"),l=e(this).attr("data-id"),p=(t=d,(o=""===(o=e("#tmpcoder_"+i+"_conditions").val())||"[]"===o?{}:JSON.parse(o))[t]=[],c=[],e(".target_rule-condition").each(function(t){c.push(e(this).val())}),c);if(""!=p&&!a&&("basic-global"!=p||void 0===p)){alert('Please select "Entire Site" to continue! Mutiple and custom conditions are fully supported in the Pro version.');return}e("#tmpcoder_"+i+"_conditions").val(JSON.stringify(p));var m=[];e("select.target_rule-specific-page").each(function(){m.push(e(this).val())});var u={action:"tmpcoder_save_template_conditions",nonce:TmpcoderPluginOptions.nonce,template:d};u["bsf-target-rules-location"]={},u["bsf-target-rules-location"].rule=[],u["bsf-target-rules-location"].rule=p,u["bsf-target-rules-location"].specific=[],u["bsf-target-rules-location"].specific=m,u["bsf-target-rules-location"]=JSON.stringify(u["bsf-target-rules-location"]),u["tmpcoder_"+i+"_conditions"]=p,s("save_btb"),e.post(ajaxurl,u,function(t){for(var o in n.fadeOut(),r("save_btb"),e("#current-layout-"+l).attr("data-conditions",JSON.stringify(p)),e("#current-layout-"+l).attr("data-specific",JSON.stringify(m)),p)p[o]&&0!==p[o].length?e('.tmpcoder-delete-template[data-slug="'+o+'"]').closest("li").addClass("tmpcoder-active-conditions-template"):e('.tmpcoder-delete-template[data-slug="'+o+'"]').closest("li").removeClass("tmpcoder-active-conditions-template");if(n.hasClass("editor-redirect")){var i=TmpcoderPluginOptions.admin_url+"post.php?post="+l+"&action=elementor";i=TmpcodersanitizeURL(i),window.location.href=i;return}})}),(e("body").hasClass("sastra-elementor-addon_page_tmpcoder-theme-builder")||e("body").hasClass("sastra-elementor-addon_page_tmpcoder-popups"))&&i&&"my_templates"!==i){var f=e("#tmpcoder_"+i+"_conditions").val(),f=""===f||"[]"===f?{}:JSON.parse(f);for(var v in f)e('.tmpcoder-delete-template[data-slug="'+v+'"]').closest("li").addClass("tmpcoder-active-conditions-template")}e(".tmpcoder-settings-page form").submit(function(){var t=e(this).serialize();return e(".welcome-backend-loader").fadeIn(),e(".tmpcoder-theme-welcome").css("opacity","0.5"),e.post("options.php",t).error(function(){e(".welcome-backend-loader").fadeOut(),e(".tmpcoder-theme-welcome").css("opacity","1")}).success(function(){e(".welcome-backend-loader").fadeOut(),e(".tmpcoder-theme-welcome").css("opacity","1"),e(".tmpcoder-settings-saved").stop().fadeIn(500).delay(1e3).fadeOut(1e3)}),!1}),e(".tmpcoder-element").find("input").on("change",function(){e(".tmpcoder-settings-page form").submit()}),e(".tmpcoder-btn-group").on("click",".tmpcoder-btn",function(){e(".tmpcoder-btn-group input").trigger("click");var t=e(this),o=t.hasClass("tmpcoder-btn-enable");t.hasClass("active")||(e(".tmpcoder-btn-group .tmpcoder-btn").removeClass("active"),t.addClass("active")),o?(e(".tmpcoder-btn-group .tmpcoder-btn-unused").removeClass("dimmed"),e(".tmpcoder-element").find("input").prop("checked",!0)):(e(".tmpcoder-btn-group .tmpcoder-btn-unused").addClass("dimmed"),e(".tmpcoder-element").find("input").prop("checked",!1)),e(".tmpcoder-settings-page form").submit()}),e("body").on("click",".tmpcoder-setting-custom-img-upload button",function(t){t.preventDefault();var o=e(this);if(o.find("img").length)o.find("img").remove(),o.prepend('<i class="dashicons dashicons-cloud-upload"></i>'),o.find("span").text("Upload Image"),e("#tmpcoder_wl_plugin_logo").val("");else var n=wp.media({title:"Insert image",library:{uploadedTo:wp.media.view.settings.post.id,type:"image"},button:{text:"Use this image"},multiple:!1}).on("select",function(){var t=n.state().get("selection").first().toJSON();o.find("i").remove(),o.prepend('<img src="'+t.url+'">'),o.find("span").text("Remove Image"),e("#tmpcoder_wl_plugin_logo").val(t.id)}).open()});var g=null;e(".tmpcoder-widgets-search").find("input").keyup(function(t){if(13===t.which)return!1;var o=e(this).val().toLowerCase();null!=g&&clearTimeout(g),g=setTimeout(function(){g=null;let t="none";e(".tmpcoder-widgets-not-found").hide(),e(".submit").show(),""!==o?(e(".tmpcoder-elements, .tmpcoder-element-box-inner, .tmpcoder-elements-heading").hide(),e(".tmpcoder-widgets-not-found").hide()):(e(".tmpcoder-elements, .tmpcoder-element, .tmpcoder-elements-heading").show(),e(".tmpcoder-elements-filters li").first().trigger("click")),e(".tmpcoder-element-box-inner").each(function(){-1!==e(this).find("h3").text().toLowerCase().indexOf(o)&&(e(this).show(),e(this).parent().show(),t="visible")}),"none"===t&&(e(".tmpcoder-widgets-not-found").css("display","flex"),e(".submit").hide())},1e3)}),e(".tmpcoder-elements-filters li").on("click",function(){let t=e(this).data("filter");e(".tmpcoder-elements-toggle").hide(),e(".tmpcoder-elements-filters li").removeClass("tmpcoder-active-filter"),e(this).addClass("tmpcoder-active-filter"),"all"===t?(e(".tmpcoder-elements, .tmpcoder-elements-heading").show(),e(".tmpcoder-elements-toggle").show()):"creative"===t?(e(".tmpcoder-elements, .tmpcoder-elements-heading").hide(),e(".tmpcoder-elements-general").show(),e(".tmpcoder-elements-general").prev(".tmpcoder-elements-heading").show()):"theme"===t?(e(".tmpcoder-elements, .tmpcoder-elements-heading").hide(),e(".tmpcoder-elements-theme").show(),e(".tmpcoder-elements-theme").prev(".tmpcoder-elements-heading").show()):"extensions"===t?(e(".tmpcoder-elements, .tmpcoder-elements-heading").hide(),e(".tmpcoder-elements-extensions").show(),e(".tmpcoder-elements-extensions").prev(".tmpcoder-elements-heading").show()):(e(".tmpcoder-elements, .tmpcoder-elements-heading").hide(),e(".tmpcoder-elements-woo").show(),e(".tmpcoder-elements-woo").prev(".tmpcoder-elements-heading").show())})});